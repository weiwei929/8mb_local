services:
  8mblocal:
    image: jms1717/8mblocal:latest
    container_name: 8mblocal
    ports:
      - "8001:8001"
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./.env:/app/.env  # optional custom settings
    
    # GPU configuration: enable NVIDIA GPUs by default. Ensure your host has
    # the NVIDIA Container Toolkit / drivers available. On Linux, mounting
    # /dev/dri may be required for VAAPI; on WSL2 ensure GPU support is
    # enabled in Docker Desktop.
    gpus: all
    # NVIDIA runtime / GPU environment (keep REDIS_URL above)
    environment:
      - REDIS_URL=redis://127.0.0.1:6379/0
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
      # Optional: enable VAAPI driver name for Intel/AMD when /dev/dri is mounted
      - LIBVA_DRIVER_NAME=iHD
    restart: unless-stopped
