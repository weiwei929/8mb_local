services:
  8mblocal:
    image: jms1717/8mblocal:latest
    container_name: 8mblocal
    ports:
      - "8001:8001"
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./.env:/app/.env  # optional custom settings
    environment:
      - REDIS_URL=redis://127.0.0.1:6379/0
      # Intel VAAPI/QSV: enable only on Linux hosts with Intel/AMD GPUs
      # - LIBVA_DRIVER_NAME=iHD
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # === GPU configuration ===
    # If you have an NVIDIA GPU, the container will be started with GPU access
    # (gpus: all) so NVENC/NVDEC can be used by ffmpeg inside the container.
    gpus: all

    # If you instead have Intel/AMD and want VAAPI/QSV on Linux hosts, replace
    # the above with the devices mapping below (uncomment and use on Linux only):
    # devices:
    #   - "/dev/dri:/dev/dri"
    # environment:
    #   - LIBVA_DRIVER_NAME=iHD
    restart: unless-stopped
